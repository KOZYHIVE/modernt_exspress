// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id                 Int            @id @default(autoincrement())
  username           String         @unique
  email              String         @unique
  password           String
  url_profile        String?
  secure_url_profile String?
  public_url_profile String?
  role               Role           @default(user)
  status             UserStatus     @default(active)
  otp                Int?
  created_at         DateTime       @default(now())
  updated_at         DateTime       @updatedAt
  detail_user        DetailUser?
  logs               Log[]
  refresh_token      RefreshToken[]
  banner             Banner[]
  rental             Rental[]
  transaction        Transaction[]
}

enum Role {
  user
  admin
}

enum UserStatus {
  active
  pending
  suspend
}

model DetailUser {
  id         Int      @id @default(autoincrement())
  user_id    Int      @unique
  full_name  String
  address    String
  phone      String
  gender     Gender
  dob        DateTime
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
  user       User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

enum Gender {
  male
  female
}

model Log {
  id          Int    @id @default(autoincrement())
  user_id     Int
  action      Action
  description String
  created_at  BigInt
  user        User   @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

enum Action {
  login
  logout
  add_car
  update_car
  delete_car
  booking_car
  confirm_payment
  canceled_booking
}

model RefreshToken {
  id            Int      @id @default(autoincrement())
  user_id       Int
  refresh_token String?  @db.VarChar(1024)
  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt
  user          User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

model Vehicle {
  id                     Int                    @id @default(autoincrement())
  brand_id               Int
  vehicle_type           VehicleType
  vehicle_name           String
  rental_price           Int
  availability_status    AvailabilityStatus     @default(available)
  year                   DateTime
  seats                  Int
  horse_power            Int
  description            String
  specification_list     String
  local_image_path       String?
  created_at             DateTime               @default(now())
  updated_at             DateTime               @updatedAt
  brand                  Brand                  @relation(fields: [brand_id], references: [id], onDelete: Cascade)
  vehicle_specifications VehicleSpecification[]
  rental                 Rental[]
}

enum VehicleType {
  motorcycle
  car
}

enum AvailabilityStatus {
  available
  rented
  inactive
}

model Brand {
  id               Int       @id @default(autoincrement())
  brand_name       String
  local_image_path String? // Path file lokal untuk gambar
  created_at       DateTime  @default(now())
  updated_at       DateTime  @updatedAt
  vehicles         Vehicle[]
}

model VehicleSpecification {
  id                 Int      @id @default(autoincrement())
  vehicle_id         Int
  specification String
  created_at         DateTime @default(now())
  updated_at         DateTime @updatedAt
  vehicle            Vehicle  @relation(fields: [vehicle_id], references: [id], onDelete: Cascade)
}

model Rental {
  id                Int           @id @default(autoincrement())
  vehicle_id        Int
  start_date        DateTime
  end_date          DateTime
  delivery_location String
  rental_status     RentalStatus
  total_price       Int
  created_at        DateTime      @default(now())
  updated_at        DateTime      @updatedAt
  vehicle           Vehicle       @relation(fields: [vehicle_id], references: [id], onDelete: Cascade)
  transaction       Transaction[]

  User User[]
}

enum RentalStatus {
  pending
  confirmed
  canceled
}

model Transaction {
  id               Int        @id @default(autoincrement())
  user_id          Int
  rental_id        Int
  payment_status   PaymentStatus
  transaction_date DateTime
  payment_method   PaymentMethod
  total_amount     Int
  local_image_path       String?
  created_at       DateTime      @default(now())
  updated_at       DateTime      @updatedAt
  user             User          @relation(fields: [user_id], references: [id], onDelete: Cascade)
  rental           Rental        @relation(fields: [rental_id], references: [id], onDelete: Cascade)
}

enum PaymentStatus {
  paid
  unpaid
  pending
}

enum PaymentMethod {
  credit_card
  debit_card
  bank_transfer
}

model Banner {
  id                 Int      @id @default(autoincrement())
  user_id            Int
  description        String
  local_image_path   String?
  created_at         DateTime @default(now())
  updated_at         DateTime @updatedAt
  user               User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

model Token {
  id        Int    @id @default(autoincrement())
  token     String @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

